language: objective-c
osx_image: xcode10

env:
  global:
  - WORKSPACE="FundaAPI.xcworkspace"
  secure: RrA/JvVzj7+sIsB4dw7HNVDA+ZGDTqRZF3IKRMMfeLUPm5GjoFpozCLiGBrnHnDFWL0gqx6Xzk0PL0auALuwQo2tZAG9V2mARjaT1KbGoTyoUXiaUX7701c7/BXx/pNsSWOVLNU9B9fa9A3/GOTy1Tji3L76XoJ1c9P8ybhw5a6sSbzvnaP4lYFjjkxDrO0FdlhCHNWKdigxP4TlXoBNDSw3Qw6Twi2iKrllHqm7trLyQ9riz3pc3ZaPf2tG2ivBcRrvRgSo/r8m7It31iiRrQ2SO3uXTa52nWpnL0l+miMAKmXoAwJgp88vcWDlHrc8hYez4/Sm8ovFYzlSFmmj2XWdWZyC3pdORyGB83bJnHMS9LljBYb9lr9qL1sldbGRn2q1z1kjlT3/KWdoh6Icr2X4wXuC/tC4pU+0fb36cNG+iiYISB7At7OLaYbFvyVGLPz6ivWgtV0nhq5VlttZUyA1NMOeedkUEHfo/qLhOQ+oPva6MaRPDlOjAJiWJckXoq1/vzO66jWdY6ykAMXgMa+WNbscrl2rozArA4MkggiTmiOqfEVKC/V2nwUkOJpbxMSF2G4F1LVwCnbcicYvji253RolyV8Pn57G/61ltjDhNa/+0eXf4jFkgTZLO3NBKT36861ghFxQlECHKFPNnX3quNFs7rf5E5ncRjLxB3c=

  matrix:
  - DESTINATION="OS=12.0,name=iPhone 6"   SCHEME="ApiProvider"        ACTION="build test"
  - DESTINATION="platform=macOS"          SCHEME="ApiProviderMac"     ACTION="build test"
  - DESTINATION="OS=12.0,name=iPhone 6"   SCHEME="FundaApi"           ACTION="build test"
  - DESTINATION="platform=macOS"          SCHEME="FundaApiMac"        ACTION="build test"

before_install:
  - brew update
  - brew outdated xctool || brew upgrade xctool
  - gem install xcpretty --no-rdoc --no-ri --no-document --quiet

before_script:
  - python ./scripts/apply_secret.py $FUNDA_API_KEY

script:
  - set -o pipefail
  - xcodebuild -scheme "$SCHEME" -workspace "$WORKSPACE" -destination "$DESTINATION" clean $ACTION | xcpretty

after_success:
  - bash <(curl -s https://codecov.io/bash)
